{% extends "base.html" %}
{% block title %}Search CVs{% endblock %}
{% block content %}
  <div class="search-card">
    <h2>Search Contractors</h2>
    <form action="{{ url_for('search') }}" method="post">
      <label for="query">Name contains:</label>
      <input type="text" name="query" id="query" value="{{ query }}" placeholder="e.g. Paul" />

      <label for="skill">Skill (e.g. python):</label>
      <input type="text" name="skill" id="skill" value="{{ skill }}" placeholder="e.g. python" />

      <label for="area">Area/Location:</label>
      <input type="text" name="area" id="area" value="{{ area }}" placeholder="e.g. Manchester" />

      <label for="date_from">From:</label>
      <input type="date" name="date_from" id="date_from" value="{{ date_from }}"/>

      <label for="date_to">To:</label>
      <input type="date" name="date_to" id="date_to" value="{{ date_to }}"/>

      <label for="ai_query">AI Search (natural language):</label>
      <input type="text" name="ai_query" id="ai_query" value="{{ ai_query }}" placeholder="e.g. DevOps lead in Manchester, AWS skills" />

      <button type="submit">Search</button>
    </form>

    {% if results %}
      <h2>Results:</h2>
      <ul class="results-list">
        {% for user, cv in results %}
          <li>
            <strong>{{ user.name }}</strong>
            {% if user.area %}<span style="color:#666;">({{ user.area }})</span>{% endif %}
            <small>(uploaded {{ cv.upload_time.strftime('%Y-%m-%d') }})</small><br/>
            <em>Tags:</em> {{ cv.tags | map(attribute='tag') | join(', ') }}<br/>
            <em>AI Summary:</em> {{ cv.summary or "-" }}<br/>
            <a href="{{ url_for('download_resume', resume_id=cv.id) }}">Download CV</a>
            {% if current_user.role in ['agency', 'manager'] %}
              <form action="{{ url_for('ai_assess', resume_id=cv.id) }}" method="post" style="display:inline;">
                <button type="submit" class="btn btn-sm">AI Assess</button>
              </form>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% elif request.method=='POST' %}
      <p>No matches found.</p>
    {% endif %}
  </div>
{% endblock %}
